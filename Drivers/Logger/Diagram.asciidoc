+---------------------------------------------------------------------------------+
|                                                                                 |
|                              User Application                                   |
|  (Initiates logging operations)                                                 |
+---------------------------------------------------------------------------------+
      |
      | 1. Calls Logger::init() (once at system startup)
      | 2. Calls Logger::logData() (repeatedly, with data)
      |
      V
+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                                                                                                           Logger Class                                                                                                                                                                                                |
|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|                                                                                                                                                                                                                                                                                                                                                                 |
|  +---------------------------+      +-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+                                        |
|  |                           |      |                                                                                                 Data Logging Workflow                                                                                                     |                                                        |
|  |   Logger::init()          +------> [Logger::Reset_openlog()]                                                                                                                                                                                                           |                                                        |
|  | (System initialization)   |      |                                                                                                                                                                                                                               |                                                        |
|  | (Verifies OpenLog startup)|      |                                                                                                                                                                                                                               |                                                        |
|  +--------+------------------+      |                                                                                                                                                                                                                               |                                                        |
|           |                         |  +----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+               |                                                        |
|           |                         |  |                                                                        Logger::logData()                                                                                                                   |               |                                                        |
|           |                         |  | (Receives ILoggable object, std::string, or raw uint8_t* buffer)                                                                                                                                       |               |                                                        |
|           |                         |  |                                                                                                                                                                                                          |               |                                                        |
|           |                         |  |  [ILoggable Object] --(calls toString())--> \                                                                                                                                                           |               |                                                        |
|           |                         |  |  [std::string]                             >---> [Data Prepared for UART TX] ------------------------------------------------------------------------------------------------------------------------------------------+       |               |                                                        |
|           |                         |  |  [uint8_t* Buffer]                         /                                                                                                                                                                            |       |               |                                                        |
|           |                         |  |                                                                                                                                                                                                          |       |               |                                                        |
|           |                         |  |  [Call Logger::updateRecords(data_length)] <---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+       |               |                                                        |
|           |                         |  +----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+       |               |                                                        |
|           |                         |                                                                                                                                                                                                                               |                                                        |
|           |                         |                                                                                                                                                                                                                               |                                                        |
|           |                         |  +----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+       |                                                        |
|           |                         |  |                                                                        Logger::updateRecords()                                                                                                             |       |                                                        |
|           |                         |  | (Manages File Size & Automated Rotation)                                                                                                                                                               |       |                                                        |
|           |                         |  |                                                                                                                                                                                                          |       |                                                        |
|           |                         |  |  [DataWritten Counter] --- (Increments with 'len' from logData)                                                                                                                                        |       |                                                        |
|           |                         |  |                                  |                                                                                                                                                                         |       |                                                        |
|           |                         |  |                                  +-----> (IF DataWritten > FileSizeLim THEN)                                                                                                                               |       |                                                        |
|           |                         |  |                                           |                                                                                                                                                               |       |                                                        |
|           |                         |  |                                           V                                                                                                                                                               |       |                                                        |
|           |                         |  |                                  [Logger::enter_cmd_mode()]                                                                                                                                              |       |                                                        |
|           |                         |  |                                           | (Sends '+++' to OpenLog, expects '>' prompt)                                                                                                                  |       |                                                        |
|           |                         |  |                                           V                                                                                                                                                               |       |                                                        |
|           |                         |  |                                  [Send "ls\r\n" Command]                                                                                                                                                 |       |                                                        |
|           |                         |  |                                           | (Receives OpenLog file list response)                                                                                                                         |       |                                                        |
|           |                         |  |                                           V                                                                                                                                                               |       |                                                        |
|           |                         |  |                                  [Logger::extract_last_log()]                                                                                                                                              |       |                                                        |
|           |                         |  |                                           | (Parses 'ls' output to find next sequential LOGXXXXX.TXT number)                                                                                              |       |                                                        |
|           |                         |  |                                           V                                                                                                                                                               |       |                                                        |
|           |                         |  |                                  [Construct "append LOGXXXXX.TXT\r\n" Command]                                                                                                                             |       |                                                        |
|           |                         |  |                                           | (Sends command to OpenLog to switch/create new file)                                                                                                          |       |                                                        |
|           |                         |  |                                           +-----> [DataWritten Counter Reset to 0]                                                                                                                        |       |                                                        |
|           |                         |  |                                                                                                                                                                                                          |       |                                                        |
|           |                         +----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+       |                                                        |
|           |                                                                                                                                                                                                                                               |                                                        |
|           | (All internal Logger methods like toString(), Reset_openlog(), enter_cmd_mode(), extract_last_log() communicate with the STM32 HAL Layer for I/O and timing.)                                                                                                                                                                            |
+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Tx Data / Commands
      | Rx Data / Responses
      | GPIO Control
      | Delay Requests
      V
+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                                                                                                    STM32 HAL Layer (Hardware Abstraction Layer)                                                                                                                                                                               |
|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [HAL_UART_Transmit] <---------------------- [Data Prepared for UART TX] <-------------------------- [Command for UART TX]                                                                                                                                                                                                                                      |
|                                                                                                                                                                                                                                                                                                                                                                 |
| [HAL_UART_Receive] ------------------------> [OpenLog Response/Data] ------------------------------> [Status/Data to Logger Class]                                                                                                                                                                                                                               |
|                                                                                                                                                                                                                                                                                                                                                                 |
| [HAL_GPIO_WritePin] <---------------------- [GPIO Pin State Toggle for OpenLog Reset]                                                                                                                                                                                                                                                                           |
|                                                                                                                                                                                                                                                                                                                                                                 |
| [HAL_Delay] <------------------------------ [Timing Control for Resets and Delays]                                                                                                                                                                                                                                                                                |
+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | UART Transmit Line                                ^ UART Receive Line
      | GPIO Reset Line                                   |
      V                                                   |
+---------------------------------------------------------------------------------+
|                                                                                 |
|                              STM32 Peripherals                                  |
|  (Hardware Modules on STM32 Chip)                                               |
+---------------------------------------------------------------------------------+
      | UART Tx Pin
      | GPIO Output Pin
      V
+---------------------------------------------------------------------------------+
|                                                                                 |
|                          OpenLog Device                                         |
|                    (External Serial Data Logger Module)                         |
|                                                                                 |
|  +-------------------+      +-------------------+      +-------------------+    |
|  | UART RX Interface |<-----| UART TX Interface |      | GPIO RST Interface|<---+ (Connects to STM32 GPIO)
|  | (Receives data/   |      | (Sends responses  |      | (Receives reset   |    |
|  | commands from STM32) |      | & startup msgs to STM32)  | (signal from STM32) |    |
|  +--------+----------+      +--------+----------+      +--------+----------+    |
|           |                                                      ^                |
|           | (Internal Data/Command Processing)                   |                |
|           V                                                      |                |
|  +-----------------------------------------------------------------+                |
|  |                  OpenLog Internal Logic                       |                |
|  | (Parses commands, writes data to SD, manages files, sends responses) |                |
|  +-----------------------------------------------------------------+                |
|           | (Writes Logged Data)                                                    |
|           V                                                                         |
|  +-------------------+                                                            |
|  |     SD Card       |                                                            |
|  | (Physical Storage |                                                            |
|  |  for Log Files)   |                                                            |
|  +-------------------+                                                            |
|                                                                                 |
+---------------------------------------------------------------------------------+